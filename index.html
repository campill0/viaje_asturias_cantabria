<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa familiar â€“ Asturias & Cantabria</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Leaflet-measure (opcional) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-measure/dist/leaflet-measure.css">
  <script src="https://unpkg.com/leaflet-measure/dist/leaflet-measure.js"></script>

  <style>
    html,body{margin:0;padding:0;height:100%}
    #map{height:100%}

    /* â€”â€”â€” Pop-ups â€”â€”â€” */
    .popup-content{font-family:Arial,sans-serif;font-size:14px;line-height:1.4;max-width:220px}
    .popup-title{font-size:16px;font-weight:bold;margin-bottom:5px}
    .popup-content ul{padding-left:20px;margin:5px 0}
    .popup-content li{margin-bottom:4px}
    .popup-link{display:block;margin-top:6px;font-size:13px;color:#1a0dab;text-decoration:underline}

    /* â€”â€”â€” Search box â€”â€”â€” */
    #searchBox{
      position:absolute;top:10px;left:60px;z-index:1000;
      box-shadow:0 1px 4px rgba(0,0,0,.3);
    }
    #filterInput{
      width:220px;padding:6px 8px;border:1px solid #aaa;border-radius:4px;
      font-size:14px;outline:none;
    }

    /* â€”â€”â€” Sidebar â€”â€”â€” */
    #sidebar{
      position:absolute;top:0;right:0;height:100%;width:270px;
      background:#fff;box-shadow:-2px 0 5px rgba(0,0,0,.25);
      transform:translateX(270px);transition:transform .3s ease;
      z-index:999;
      display:flex;flex-direction:column;
    }
    #sidebar.open{transform:translateX(0)}
    #toggleSidebar{
      position:absolute;right:270px;top:50%;transform:translateY(-50%);
      background:#fff;border:1px solid #ccc;border-right:none;
      border-radius:4px 0 0 4px;padding:4px 8px;cursor:pointer;
      box-shadow:-2px 0 4px rgba(0,0,0,.25);z-index:1000;
    }
    #sidebar h3{margin:10px;font-size:16px;font-family:Arial}
    #listado{
      flex:1;overflow-y:auto;padding:0 10px 15px 15px;
      font-family:Arial;font-size:14px;
    }
    #listado li{margin:4px 0;cursor:pointer;color:#0645ad;text-decoration:underline}
  </style>
</head>
<body>

<!-- Capa de bÃºsqueda -->
<div id="searchBox">
  <input id="filterInput" type="text" placeholder="Filtrar lugaresâ€¦">
</div>

<!-- BotÃ³n de la barra -->
<button id="toggleSidebar">â˜°</button>

<!-- Barra lateral -->
<div id="sidebar">
  <h3>Puntos visibles</h3>
  <ul id="listado"></ul>
</div>

<div id="map"></div>

<script>
/* === 1. Mapa base === */
const map = L.map('map').setView([43.4,-4.9],8);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap contributors'
}).addTo(map);

/* Herramienta de mediciÃ³n */
new L.Control.Measure({
  position:'topleft',
  primaryLengthUnit:'kilometers',
  secondaryLengthUnit:'meters'
}).addTo(map);

/* === 2. Iconos de color (leaflet-color-markers) === */
function iconoColor(c){
  const b='https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/';
  return L.icon({
    iconUrl:`${b}marker-icon-2x-${c}.png`,
    iconRetinaUrl:`${b}marker-icon-2x-${c}.png`,
    shadowUrl:`${b}marker-shadow.png`,
    iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]
  });
}

const iconos={
  alojamiento : iconoColor('violet'),
  restauracion: iconoColor('orange'),
  patrimonio  : iconoColor('red'),
  museos      : iconoColor('red'),
  naturaleza  : iconoColor('green'),
  playas      : iconoColor('blue'),
  rutas       : iconoColor('yellow'),
  miradores   : iconoColor('grey'),
  queserias   : iconoColor('black')
};
const fallbackIcon=iconoColor('black');

/* === 3. Array de destinos (el que ya tienes) === */
const destinos=[
  {nombre:"SebreÃ±u",categoria:"alojamiento",coords:[43.4607343,-5.0862242],detalles:["ðŸ˜ï¸ Aldea rural con hÃ³rreos","ðŸŒ… Mirador al CantÃ¡brico","ðŸ¯ Miel artesana"]},
  {nombre:"Cueva de Tito Bustillo",categoria:"museos",coords:[43.4612547,-5.0680492],detalles:["ðŸŽ¨ Arte rupestre Patrimonio Mundial","ðŸ•³ï¸ GalerÃ­a de pinturas","ðŸ›ï¸ Centro de interpretaciÃ³n"]},
  {nombre:"Ribadesella",categoria:"playas",coords:[43.463111,-5.0566643],detalles:["ðŸ¦• Huellas de dinosaurios","ðŸ–ï¸ Playa Santa Marina","ðŸ¥© Cachopo en SidrerÃ­a"]},
  {nombre:"Bufones de PrÃ­a",categoria:"naturaleza",coords:[43.4584154,-4.9797614],detalles:["ðŸŒŠ Chorros marinos","ðŸš¶ Senda a Cuevas del Mar","ðŸ“¸ Mirador atardecer"]},
  {nombre:"Playa de Gulpiyuri",categoria:"playas",coords:[43.4474967,-4.8859819],detalles:["ðŸ–ï¸ Playa interior","ðŸŒŠ Piscina con marea","ðŸƒ Pradera picnic"]},
  {nombre:"MUJA (Colunga)",categoria:"museos",coords:[43.5010405,-5.2740996],detalles:["ðŸ¦• Museo JurÃ¡sico","ðŸ–¼ï¸ RÃ©plicas tamaÃ±o real","â˜• CafÃ© temÃ¡tico"]},
  {nombre:"Lastres",categoria:"patrimonio",coords:[43.5139204,-5.27055],detalles:["ðŸ˜ï¸ Villa marinera","ðŸ–ï¸ Playa La Griega","ðŸ¤ Marisco fresco"]},
  {nombre:"Mirador del Fitu",categoria:"miradores",coords:[43.4388106,-5.1925387],detalles:["ðŸŒ„ 360Â° vistas","ðŸš¶ Sendero Pico Pienzu","ðŸ“¸ Plataforma"]},
  {nombre:"Llanes",categoria:"playas",coords:[43.4211483,-4.7562159],detalles:["ðŸ–ï¸ Playas Poo y Torimbia","ðŸŽ¨ Cubos de la Memoria","ðŸ¦ Helado artesanal"]},
  {nombre:"Cangas de OnÃ­s",categoria:"rutas",coords:[43.3506429,-5.1311817],detalles:["ðŸŒ‰ Puente Romano","ðŸ§€ Mercado GamonÃ©u","ðŸš£ Descenso del Sella"]},
  {nombre:"Playa de Rodiles",categoria:"playas",coords:[43.5317372,-5.3769428],detalles:["ðŸ„â€â™‚ï¸ Surf internacional","ðŸŒ² Pinar merenderos","ðŸš¶ Paseo fluvial"]},
  {nombre:"Tazones",categoria:"patrimonio",coords:[43.5452665,-5.4062829],detalles:["ðŸ˜ï¸ Puerto ballenero","ðŸ‘‘ Desembarco Carlos V","ðŸ¦ª Ostras y mariscos"]},
  {nombre:"Covadonga",categoria:"patrimonio",coords:[43.3123308,-5.0593809],detalles:["â›ª BasÃ­lica","ðŸžï¸ Lagos Enol y Ercina","ðŸ¥§ Carbayones"]},
  {nombre:"Restaurante La Parrilla de Prellezo",categoria:"restauracion",coords:[43.380235,-4.4397117],detalles:["ðŸ– Parrilladas","ðŸŒ… Terraza al mar","ðŸ¥‚ Vinos cÃ¡ntabros"]},
  {nombre:"JardÃ­n BotÃ¡nico AtlÃ¡ntico",categoria:"naturaleza",coords:[43.5215086,-5.6158997],detalles:["ðŸŒ¿ Flora cantÃ¡brica","ðŸš¶ Carbayera centenaria","ðŸ¦ Observatorio aves"]},
  {nombre:"Santuario de Covadonga",categoria:"patrimonio",coords:[43.3075477,-5.0546135],detalles:["ðŸ™ Santa Cueva","ðŸŽ¶ Ã“rgano histÃ³rico","ðŸ›ï¸ Recuerdos"]},
  {nombre:"San Vicente de la Barquera",categoria:"patrimonio",coords:[43.3813069,-4.397058],detalles:["ðŸ° Castillo del Rey","ðŸ–ï¸ Playa MerÃ³n","ðŸ¨ Helado Regma"]},
  {nombre:"GijÃ³n",categoria:"playas",coords:[43.5322493,-5.6609733],detalles:["ðŸ–ï¸ Playa San Lorenzo","ðŸ  Acuario","ðŸŒ³ JardÃ­n BotÃ¡nico","ðŸ½ï¸ Sidra y tapas"]},
  {nombre:"Parque Isabel la CatÃ³lica",categoria:"naturaleza",coords:[43.5369271,-5.6399657],detalles:["ðŸŒ³ Jardines y estanques","ðŸ¦š Pavos reales","ðŸš´ Carril bici"]},
  {nombre:"Playa de San Lorenzo",categoria:"playas",coords:[43.5410462,-5.6500665],detalles:["ðŸ–ï¸ Arena fina","ðŸ„â€â™€ï¸ Escuela surf","ðŸŒ… Paseo marÃ­timo"]},
  {nombre:"Parque Natural de Oyambre",categoria:"naturaleza",coords:[43.3836382,-4.3590402],detalles:["ðŸŒ¾ Dunas protegidas","ðŸ¦ Aves migratorias","ðŸ–ï¸ Playa virgen"]},
  {nombre:"Acuario de GijÃ³n",categoria:"museos",coords:[43.5424604,-5.6766247],detalles:["ðŸ  TÃºnel 360Â°","ðŸ¦ˆ Tiburones","ðŸ‘¨â€ðŸ‘©â€ðŸ‘¦ Talleres"]},
  {nombre:"Comillas",categoria:"patrimonio",coords:[43.3856192,-4.2922535],detalles:["ðŸ›ï¸ El Capricho de GaudÃ­","ðŸŒ³ Parque Sobrellano","ðŸ· MenÃº familiar"]},
  {nombre:"Luanco",categoria:"patrimonio",coords:[43.6136722,-5.792911],detalles:["âš“ Museo MarÃ­timo","ðŸŸ Pescados frescos","ðŸš¶ Paseo marÃ­timo"]},
  {nombre:"Cueva de El Soplao",categoria:"naturaleza",coords:[43.2964859,-4.4101414],detalles:["ðŸ’Ž Estalactitas Ãºnicas","ðŸš‚ Tren minero","ðŸ“½ï¸ ProyecciÃ³n geologÃ­a"]},
  {nombre:"Santillana del Mar",categoria:"alojamiento",coords:[43.3873327,-4.1066092],detalles:["ðŸ° Casco medieval","ðŸ¦ Zoo","ðŸŒ¿ Laberinto"]},
  {nombre:"Cabo de PeÃ±as",categoria:"miradores",coords:[43.646132,-5.85121],detalles:["ðŸŒŠ Acantilados","ðŸ  Faro","ðŸ¥¾ Ruta costera"]},
  {nombre:"Suances",categoria:"playas",coords:[43.4257047,-4.0427225],detalles:["ðŸ–ï¸ Playa Los Locos","ðŸ° Faro Torco","ðŸ¤ Mariscos"]},
  {nombre:"Cudillero",categoria:"patrimonio",coords:[43.5629162,-6.1452648],detalles:["ðŸ˜ï¸ Casas de colores","ðŸŸ Rula diaria","ðŸ² Caldereta"]},
  {nombre:"Santander",categoria:"playas",coords:[43.4636346,-3.8226402],detalles:["ðŸ° Palacio Magdalena","ðŸ–ï¸ Playa Sardinero","ðŸ¦ Tapas Paseo Pereda"]},
  {nombre:"CabÃ¡rceno",categoria:"naturaleza",coords:[43.3581451,-3.8227696],detalles:["ðŸ˜ Safari semilibertad","ðŸ¦ Telecabina","ðŸ½ï¸ MenÃºs infantiles"]},
  {nombre:"Murcia",categoria:"patrimonio",coords:[37.9893044,-1.1320073],detalles:["ðŸ›ï¸ Catedral","ðŸŒ³ JardÃ­n MalecÃ³n","ðŸ‹ Paparajotes"]},
  {nombre:"Segovia",categoria:"patrimonio",coords:[40.9602655,-4.1101125],detalles:["ðŸ—ï¸ Acueducto","ðŸ° AlcÃ¡zar","â›ª Catedral","ðŸ– Cochinillo"]},
  {nombre:"SigÃ¼enza",categoria:"patrimonio",coords:[41.06448,-2.641057],detalles:["ðŸ° Castillo-Parador","â›ª Catedral","ðŸ—¿ Doncel","ðŸ· Tapas cabrito"]},
  {nombre:"CamÃ­n Encantau",categoria:"rutas",coords:[43.3967351,-4.9141557],detalles:["ðŸ¥¾ Ruta mitolÃ³gica en Llanes","ðŸŒ² Bosques y aldeas","ðŸ—¿ Esculturas tradicionales"]},
  {nombre:"Parque de la Prehistoria (Teverga)",categoria:"museos",coords:[43.1376562,-6.0755993],detalles:["ðŸ¦£ Reconstrucciones de fauna prehistÃ³rica","ðŸŽ¨ Talleres y actividades didÃ¡cticas","ðŸŒ³ Entorno natural del valle de Teverga"]}, 
 /* === QUESERÃAS (nueva categorÃ­a) === */
  {nombre:"Quesos Artesanos RebollÃ­n",categoria:"queserias",coords:[43.2504393,-5.9832577],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a La PeÃ±ona",categoria:"queserias",coords:[43.5295336,-6.1183067],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a Leche Leche",categoria:"queserias",coords:[43.4176037,-4.8037489],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a Temia",categoria:"queserias",coords:[43.3305872,-6.075697],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a DemuÃ©s",categoria:"queserias",coords:[43.3216986,-4.9871908],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a Vega de Ario",categoria:"queserias",coords:[43.3360194,-4.9697517],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a Quesos de Taramundi",categoria:"queserias",coords:[43.3603936,-7.1083458],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a Los Caserinos",categoria:"queserias",coords:[43.468115,-5.4672064],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a El Cabriteru",categoria:"queserias",coords:[43.3140512,-4.8074208],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a MaÃ­n",categoria:"queserias",coords:[43.2333596,-4.746799],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a Ca Sanchu",categoria:"queserias",coords:[43.31695,-6.131658],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
  {nombre:"QueserÃ­a Vega de TordÃ­n",categoria:"queserias",coords:[43.3029703,-4.8085097],detalles:["ðŸ§€ Queso artesanal asturiano","ðŸ›’ Tienda y degustaciÃ³n","ðŸ‘€ Visitas guiadas (consultar)"]},
{nombre:"Taramundi", categoria:"patrimonio", coords:[43.3603936,-7.1083458], detalles:["ðŸ˜ï¸ Villa artesanal de navajas","ðŸŒ¿ Paisaje de montaÃ±a","ðŸ§¶ ArtesanÃ­a y telares"]},
{nombre:"Mazonovo", categoria:"museos", coords:[43.3567245,-7.1064131], detalles:["âš™ï¸ Museo de molinos","ðŸŒŠ Canal fluvial en funcionamiento","ðŸŽ« Demostraciones en vivo"]},
{nombre:"Os TeixÃ³is", categoria:"patrimonio", coords:[43.341238,-7.0796733], detalles:["ðŸ˜ï¸ Conjunto etnogrÃ¡fico","âš’ï¸ HerrerÃ­a hidrÃ¡ulica","ðŸŒ² Ruta del agua"]},
{nombre:"As Veigas", categoria:"patrimonio", coords:[43.3276453,-7.0857983], detalles:["ðŸ˜ï¸ Aldea tradicional en valle","ðŸŒ„ Miradores de montaÃ±a","ðŸ² GastronomÃ­a local"]},
{nombre:"Cueva Huerta (Teverga)", categoria:"naturaleza", coords:[43.1242105,-6.0588549], detalles:["ðŸ•³ï¸ Cueva kÃ¡rstica declarada Monumento Natural","ðŸ¦‡ Importante colonia de murciÃ©lagos","ðŸ‘Ÿ Visitas guiadas y espeleorrutas"]},
{nombre:"Funicular de Bulnes (Picos de Europa)", categoria:"rutas", coords:[43.1872155,-4.821524], detalles:["ðŸš  Acceso subterrÃ¡neo a Bulnes","ðŸžï¸ Vistas del Macizo Central","â±ï¸ Trayecto de 7 minutos"]},
{nombre:"Museo de la Sidra (Nava)", categoria:"museos", coords:[43.3573835,-5.5050385], detalles:["ðŸ Historia y proceso de la sidra","ðŸ» Escanciado interactivo","ðŸ¥‚ DegustaciÃ³n al finalizar"]},
{nombre:"Playa de Poo", categoria:"playas", coords:[43.4289578,-4.7842527], detalles:["ðŸ–ï¸ Ensenada de agua tranquila","ðŸŒ… Marea formadora de piscina natural","ðŸ‘¨â€ðŸ‘©â€ðŸ‘§ Ideal para familias y niÃ±os"]},


];


/* === 4. Crear marcadores y almacenarlos con su data === */
const markerObjs=[];           // {marker,data}
const capas={};                // LayerGroups por categorÃ­a

destinos.forEach(d=>{
  if(!capas[d.categoria]) capas[d.categoria]=L.layerGroup().addTo(map);

  const items=d.detalles.map(t=>`<li>${t}</li>`).join('');
  const popup=`<div class="popup-content">
                 <div class="popup-title">${d.nombre}</div>
                 <ul>${items}</ul>
                 <a class="popup-link" href="https://www.youtube.com/results?search_query=${encodeURIComponent(d.nombre)}" target="_blank">Ver vÃ­deos</a>
                 <a class="popup-link" href="https://www.google.com/maps?q=${d.coords[0]},${d.coords[1]}" target="_blank">Abrir en Google Maps</a>
               </div>`;

  const icon=iconos[d.categoria]??fallbackIcon;
  //const mk=L.marker(d.coords,{icon}).bindPopup(popup).addTo(capas[d.categoria]);
  const mk = L.marker(d.coords, { icon })
  .bindPopup(popup)
  .bindTooltip(d.nombre, {
    permanent: true,
    direction: 'top',
    offset: [0, -10],      // ajusta verticalmente la etiqueta
    className: 'label-tooltip'
  })
  .addTo(capas[d.categoria]);
  markerObjs.push({marker:mk,data:d});
});

/* Control de capas */
L.control.layers(null,capas,{collapsed:false,position:'topright'}).addTo(map);

/* === 5. FILTRO de texto === */
const caja=document.getElementById('filterInput');
caja.addEventListener('input',applyFilter);

/* === 6. BAR/LISTADO lateral === */
const sidebar=document.getElementById('sidebar');
const btn=document.getElementById('toggleSidebar');
btn.onclick=()=>sidebar.classList.toggle('open');
const lista=document.getElementById('listado');

/* === 7. Funciones === */
function applyFilter(){
  const term=caja.value.trim().toLowerCase();
  markerObjs.forEach(o=>{
    const text=(o.data.nombre+' '+o.data.categoria+' '+o.data.detalles.join(' ')).toLowerCase();
    const match=text.includes(term);
    const el=o.marker.getElement();
    if(el) el.style.display=match?'':'none';
  });
  updateSidebar();
}

function updateSidebar(){
  const bnds=map.getBounds();
  const term=caja.value.trim().toLowerCase();
  let html='';
  markerObjs.forEach(o=>{
    const el=o.marker.getElement();
    if(!el||el.style.display==='none') return;           // filtrado
    if(!bnds.contains(o.marker.getLatLng())) return;     // fuera de vista
    html+=`<li onclick="panTo(${o.marker.getLatLng().lat},${o.marker.getLatLng().lng})">${o.data.nombre}</li>`;
  });
  lista.innerHTML=html||'<i>No hay resultados</i>';
}

/* Exponer funciÃ³n para los <li> */
window.panTo=(lat,lng)=>{
  sidebar.classList.remove('open');
  map.setView([lat,lng],14,{animate:true});
};

/* === 8. Actualizar listado cada vez que cambie la vista === */
map.on('moveend',updateSidebar);
map.whenReady(()=>{applyFilter();});

/* Cerrar sidebar al cargar en mÃ³vil si no hay espacio */
if(innerWidth<600) sidebar.classList.remove('open');
</script>
</body>
</html>
